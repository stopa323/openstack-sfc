---
version: '2.0'

ppg_scale:
  description: Scale Neutron PortPairGroup.
  type: direct

  input:
    - instance_id

  tasks:
    get_vm_port:
      action: neutron.list_ports
      publish:
        vm_port: '{{ task("get_vm_port").result.ports | selectattr("device_id", "equalto", _.instance_id) | map(attribute="id") | list | first }}'
      on-success:
        - get_sfc_port_pairs

    get_sfc_port_pairs:
      action: neutron.list_sfc_port_pairs
      publish:
        sfc_pairs: '{{ task("get_sfc_port_pairs").result.port_pairs | selectattr("ingress", "equalto", _.vm_port) | map(attribute="id") | list | first }}'
